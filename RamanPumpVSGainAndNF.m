%% 不同FRA泵浦时，不同输入信号功率时的增益和NF
% 1550nm
% -45dbm到-20dbm   -40 到 -25
% 200mw-550mw
clc
clear

%%
% raman data
Pin_fra= [-19.8;-25.09;-30.3;-35.3;-40;-44.7];       % Gnet
%         200mw -> 550mw
% -20dBm
%   |
% -45dBm

% Pout_on = [-35.939 -31.24 -27.208 -22.405 -19.306 -15.937];
% Pout_off = [-53.5 -45.3 -41.562 -35.001 -30.808 -24.43]+3;
Pase_fra = [-63.708 -61.265 -58.793 -56.416 -54.052 -51.632 -49.172 -46.7;
    -63.143 -60.620 -58.066 -55.543 -52.993 -50.359 -47.581 -44.716;
    -62.986 -60.435 -57.857 -55.308 -52.724 -50.133 -47.366 -47.353;
    -63.292 -60.759 -58.238 -55.771 -53.458 -50.921 -48.283 -45.900;
    -63.438 -60.766 -58.28 -55.756 -53.195 -50.608 -47.952 -45.177;
    -63.327 -60.768 -58.199 -55.629 -53.111 -50.300 -47.232 -44];     % power of ASE
Pout_on = [-19.248 -16.732 -14.28 -11.937 -9.593 -7.412 -5.315 -3.431;
    -24.287 -21.610 -18.924 -14.306 -12.726 -10.243 -7.882 -7.587;
    -30.062 -27.453 -24.974 -22.405 -20.039 -18.004 -17.956 -15.968;
    -35.208 -32.812 -30.489 -28.208 -25.697 -23.477 -21.470 -19.453;
    -38.935 -36.302 -33.73 -31.24 -28.916 -26.725 -27.662 -22.663;
    -43.802 -41.053 -38.414 -35.939 -33.771 -31.518 -29.346 -27.358];
Pout_off = [-27.43;-32.808;-38.001;-43.162;-47.3;-52.5];

% EDFA data
Pin_edfa = Pout_on;
Pase_edfa = [
    -46.295 -44.989 -44.428 -43.745 -40.685 -40.326 -40.816 -43.084;
    -46.329 -45.970 -45.459 -44.653 -44.494 -44.123 -44.467 -43.620;
    -46.030 -44.770 -45.480 -43.570 -42.860 -42.510 -41.140 -39.520;
    -46.034 -44.736 -45.271 -41.066 -41.582 -42.270 -41.710 -41.598;
    -46.101 -44.888 -45.960 -42.710 -41.398 -41.056 -40.991 -44.572;
    -46.732 -45.330 -45.710 -42.127 -43.542 -43.816 -43.174 -44.982;];
% Pase_edfa = [
%     -35.295 -34.989 -34.428 -39.745 -32.685 -31.326 -29.816 -28.084;
%     -34.329 -33.970 -33.459 -39.653 -31.494 -30.123 -28.467 -26.620;
%     -36.030 -35.770 -35.480 -37.170 -33.260 -32.110 -30.140 -28.420;
%     -34.034 -33.736 -33.271 -39.566 -31.582 -30.270 -28.710 -27.098;
%     -42.301 -42.188 -41.960 -41.710 -41.398 -41.056 -40.491 -39.572;
%     -42.232 -42.330 -42.710 -43.127 -43.542 -43.816 -43.674 -43.582;];
Pout_edfa = [-13.1420  -11.1950   -9.5840   -7.7180   -6.7170   -6.5410   -6.8080   -7.7390
  -15.9690  -13.8170  -10.4240   -8.4990   -6.0580   -4.9810   -4.4890   -3.9880
  -18.0700  -16.3000  -13.3700  -10.1000   -8.0300   -7.7000   -6.4200   -5.8300
  -21.9310  -19.3150  -16.7330  -11.0740  -11.6820  -11.8130  -11.3900  -11.1110
  -26.6110  -23.9040  -21.3460  -16.8980  -15.0220  -14.5770  -12.7840  -17.3740
  -31.7310  -28.4210  -24.0890  -19.9650  -20.8050  -20.6750  -20.1520  -21.7520];
% GAIN_fra_edfa = 41.2695   39.1506   39.5757   34.7944   32.0923   27.5107
% NF_fra_edfa = -1.8697   -0.8408   -0.4330    0.1997    0.7210    1.2019
% represent in W
Pin_fra=10.^(Pin_fra./10)*1e-3;
Pase_fra=10.^(Pase_fra./10)*1e-3;
% Pout_on=10.^(Pout_on./10)*1e-3;
% Pout_off=10.^(Pout_off./10)*1e-3;

Pin_edfa=10.^(Pin_edfa./10)*1e-3;
Pase_edfa=10.^(Pase_edfa./10)*1e-3;
Pout_edfa=10.^(Pout_edfa./10)*1e-3;

c=3e8;
h=6.62606896e-34;
wavelength=1550.912e-9;
v=c./wavelength;
Be=0.02e-9.*c./(wavelength^2);

%% 
Gain_fra_edfa = (Pout_edfa - Pase_edfa) ./ Pin_fra;
% GAIN_fra_edfa = 10.*log10(Gain_fra_edfa)
GAIN_fra_edfa = 10.*log10(Gain_fra_edfa) + Pout_on - Pout_off
NF_fra_edfa_mw = ((Pase_edfa) ./ (Gain_fra_edfa.*h*v*Be) + (1./Gain_fra_edfa));
NF_fra_edfa = 10.*log10((Pase_edfa) ./ (Gain_fra_edfa.*h*v*Be) + (1./Gain_fra_edfa))

% GAIN_fra_edfa = 41.2695   39.1506   39.5757   34.7944   32.0923   27.5107
% NF_fra_edfa = -1.8697   -0.8408   -0.4330    0.1997    0.7210    1.2019


%    12.0602   11.4037   10.3481    9.1592   11.2023   11.3841   11.1628    9.8368
%     6.5656    5.7665    4.8772    3.7497    1.4659    0.7566   -0.0766    0.2626
%     6.7546    5.2300    2.5938    1.2158   -0.1495   -0.1316   -0.0482    0.9766
%     5.6216    4.2849    1.1669   -0.3176   -0.2233   -0.7774   -0.6431   -0.8108
%     5.5677    4.0457    0.4078   -0.8224   -1.3945   -1.4992   -2.2307   -2.1978
%     5.4558    3.4799   -1.2873   -1.8606   -2.0302   -2.2342   -2.3192   -2.4135
%     
%     
%        12.0602    6.5656    6.7546    5.6216    5.5677    5.4558
%    11.4037    5.7665    5.2300    4.2849    4.0457    3.4799
%    10.3481    4.8772    2.5938    1.1669    0.4078   -1.2873
%     9.1592    3.7497    1.2158   -0.3176   -0.8224   -1.8606
%    11.2023    1.4659   -0.1495   -0.2233   -1.3945   -2.0302
%    11.3841    0.7566   -0.1316   -0.7774   -1.4992   -2.2342
%    11.1628   -0.0766   -0.0482   -0.6431   -2.2307   -2.3192
%     9.8368    0.2626    0.9766   -0.8108   -2.1978   -2.4135


%    24.2872   26.2345   27.8457   29.2118   30.7129   30.8889   30.6219   29.6908
%    24.8365   26.9894   29.3830   31.3083   32.7495   33.7886   35.2967   35.7956
%    28.9171   29.6887   32.6243   34.8956   37.9677   39.2979   41.5781   43.1680
%    31.1884   33.8221   36.4137   39.0782   41.4730   43.7433   45.7669   47.2678
%    31.5955   34.3418   36.9203   39.3789   41.6602   43.7077   45.5012   46.9096
%    32.0550   35.8837   37.2821   41.4429   32.6237   44.7653   47.2885   48.6838
 
%    14.8379   19.3012   23.3646   27.5739   30.9183   33.2752   35.1053   36.0587
%    17.6380   22.4684   28.5486   35.0919   39.1134   42.6735   45.5266   46.3225
%    20.1620   24.5418   29.9543   35.7940   40.2306   42.5956   43.9235   46.5011
%    21.3061   26.3225   31.2339   39.1756   41.0786   43.1681   45.5980   47.8941
%    21.7049   27.0592   32.2090   39.1506   43.3520   45.9882   46.8474   47.2547
%    21.5275   27.6366   34.6670   41.2695   42.6008   44.9859   47.6803   48.0693